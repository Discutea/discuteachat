!function(a){a.fn.discuteaChat=function(b){var c=a.extend({locale:"en",title:"",channel:"Accueil",url:"",post:!1,cookies:!1},b),d={username:function(){switch(c.locale){case"fr":return"Pseudo";case"es":return"Seudónimo";default:return"Nickname"}},years:function(){switch(c.locale){case"fr":return"ans";case"es":return"años";default:return"years"}},age:function(){switch(c.locale){case"fr":return"Votre age";case"es":return"Tu edad";default:return"Your age"}},country:function(){switch(c.locale){case"fr":return"Votre pays";case"es":return"Tu país";default:return"Your country"}},state:function(){switch(c.locale){case"fr":return"Votre région";case"es":return"Tu región";default:return"Your state"}},signin:function(){switch(c.locale){case"fr":return"Connexion";case"es":return"Conexión";default:return"Sign in"}},formtitle:function(){if("object"==typeof c.title&&(title=c.title[c.locale],"undefined"!=typeof title))return title;if(""!=c.title&&"object"!=typeof c.title)return c.title;switch(c.locale){case"fr":return"Tchat accès visiteurs.";case"es":return"Chat visitantes acceden.";default:return"Chat access visitors."}},channel:function(){return"object"==typeof c.channel&&(channel=c.channel[c.locale],"undefined"!=typeof channel)?channel.replace(/\s/g,"-"):"object"==typeof c.channel?"Accueil":c.channel.replace(/\s/g,"-")},appletUrl:function(){if(""!=c.url)return c.url;switch(c.locale){case"fr":return"https://kiwi.discutea.fr/";case"es":return"https://kiwi.discutea.es/";default:return"https://kiwi.discutea.net/"}}},e={username:function(){return c.cookies&&Cookies.get("Username")?user=field='value="'+Cookies.get("Username"):field='placeholder="'+d.username(),field+='"',output='<div class="field">                             <input type="text" id="username" name="username" required="required" maxlength="20" '+field+" />                           </div>",output},year:function(){for(output='<div class="field">                             <select id="age" name="age" required="required">                               <option value="">'+d.age()+"</option>",i=13;i<90;i++)output+='<option value="'+i+'"',c.cookies&&Cookies.get("Year")&&i==Cookies.get("Year")&&(output+=" selected "),output+=">"+i+" "+d.years()+"</option>";return output+="</select></div>",output},gender:function(){return output='<div class="field">                             <div id="gender">                              <input type="radio" id="gender_0" name="[gender]" required="required" value="F"',c.cookies&&Cookies.get("Sex")&&"F"==Cookies.get("Sex")&&(output+=" checked "),output+='/>                             <label for="gender_0" class="required">                               <img alt="Woman" src="https://cdn.discutea.com/img/femme.png"/>                             </label>                             <input type="radio" id="gender_1" name="[gender]" required="required" value="M"',c.cookies&&Cookies.get("Sex")&&"M"==Cookies.get("Sex")&&(output+=" checked "),output+='/>                             <label for="gender_1" class="required">                               <img alt="Man" src="https://cdn.discutea.com/img/homme.png"/>                             </label>                           </div>                         </div>',output},countries:function(){return output='<div class="field">                             <select id="country" name="country" required="required">',a.getJSON("https://discutea.fr/api/irc/form/country",function(b){b.length>0&&(countrieslist='<option value="">'+d.country()+"</option>",a.each(b,function(a,b){countrieslist+='<option value="'+b.id+'"',c.cookies&&Cookies.get("Country")&&b.id==Cookies.get("Country")&&(countrieslist+=" selected "),countrieslist+=">"+b.country+"</option>"}),a("#country").html(countrieslist))}),output+="</select></div>",output},assembler:function(){return output='<div id="discuteaTchat">                             <h3>'+d.formtitle()+'</h3>                             <form name="tchat" method="post" action="#" id="formChat">',output+=this.username(),output+=this.year(),output+=this.gender(),output+=this.countries(),output+='<div id="field_region" class="field">                              <select id="region" name="region">                                <option value="">'+d.state()+"</option>                              </select>                            </div>",output+="<div class='submit'>                              <input type='submit' class='button-chat' value='"+d.signin()+"' />                            </div></form></div>",output}},f={onCountryChange:function(b){a("#field_region").hide(),$field=a("#region"),a.getJSON("https://discutea.fr/api/irc/form/regions/"+b,function(b){$field.empty(),b.length>0&&(a.each(b,function(a,b){c.cookies&&Cookies.get("District")&&b.id==Cookies.get("District")?$field.append('<option value="'+b.id+'" selected >'+b.region+"</option>"):$field.append('<option value="'+b.id+'">'+b.region+"</option>")}),a("#field_region").show())})},onSubmit:function(b){b.preventDefault(),nick=a("#username").val(),age=a("#age").val(),a("#gender_1").is(":checked")===!0?gender="M":gender="F",country=a("#country").find("option:selected").text(),region=a("#region").find("option:selected").text(),url=d.appletUrl(),c.post===!1?(url+="?nick="+nick,url+="&age="+age,url+="&sex="+gender,url+="&country="+country,""!=region&&(url+="&district="+region),url+="&channel=#"+d.channel(),window.location.href=url):(form=a("<form></form>"),form.attr("method","post"),form.attr("action",url),form.append('<input type="hidden" name="tchat[username]" value="'+nick+'">'),form.append('<input type="hidden" name="tchat[age]" value="'+age+'">'),form.append('<input type="hidden" name="tchat[sexe]" value="'+gender+'">'),form.append('<input type="hidden" name="tchat[pays]" value="'+country+'">'),""!=region&&form.append('<input type="hidden" name="tchat[region]" value="'+region+'">'),form.append('<input type="hidden" name="tchat[channel]" value="'+d.channel()+'">'),a(form).appendTo("body").submit())}};this.html(e.assembler()),a("#field_region",this).hide(),c.cookies&&Cookies.get("Country")&&f.onCountryChange(Cookies.get("Country")),a("#country",this).change(function(){country=a(this).val(),f.onCountryChange(country),c.cookies&&Cookies.set("Country",country,{expires:365})}),c.cookies&&(a("#username",this).blur(function(){console.log(a(this).val()),Cookies.set("Username",a(this).val(),{expires:365})}),a("#age",this).change(function(){Cookies.set("Year",a(this).val(),{expires:365})}),a("#gender",this).change(function(){Cookies.set("Sex",a("input[type='radio']:checked",this).val(),{expires:365})}),a("#region",this).change(function(){Cookies.set("District",a(this).val(),{expires:365})})),a("#formChat").submit(function(a){f.onSubmit(a)})}}(jQuery);
